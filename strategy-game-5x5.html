<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5Ã—5æˆ¦ç•¥ã‚²ãƒ¼ãƒ  - æ‹ ç‚¹åˆ¶åœ§ãƒãƒˆãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            max-width: 1200px;
            width: 100%;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-title {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-status {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .player-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            flex: 1;
            min-width: 250px;
            transition: all 0.3s ease;
        }

        .player-info.active {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .player-info h2 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .player1 .player-indicator {
            background: #ff6b6b;
        }

        .player2 .player-indicator {
            background: #4ecdc4;
        }

        .resource-display {
            font-size: 1.5em;
            margin: 10px 0;
        }

        .territory-count {
            font-size: 1.2em;
            color: #ffd93d;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(5, 100px);
            grid-template-rows: repeat(5, 100px);
            gap: 5px;
            margin: 0 auto 30px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 10px;
        }

        .cell {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .cell:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .cell.territory-1 {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
        }

        .cell.territory-2 {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
        }

        .cell.base {
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255, 255, 255, 0.1) 10px,
                rgba(255, 255, 255, 0.1) 20px
            );
        }

        .cell.base-1 {
            border: 3px solid #ff6b6b;
            box-shadow: inset 0 0 20px rgba(255, 107, 107, 0.5);
        }

        .cell.base-2 {
            border: 3px solid #4ecdc4;
            box-shadow: inset 0 0 20px rgba(78, 205, 196, 0.5);
        }

        .unit {
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            position: relative;
        }

        .unit-health {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: #ffd93d;
            color: #000;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.5em;
            font-weight: bold;
        }

        .cell-coords {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 0.8em;
            opacity: 0.5;
        }

        .cell.highlight-move {
            background: rgba(100, 255, 100, 0.3) !important;
            animation: pulse 1s infinite;
        }

        .cell.highlight-attack {
            background: rgba(255, 100, 100, 0.3) !important;
            animation: pulse 1s infinite;
        }

        .cell.highlight-place {
            background: rgba(255, 255, 100, 0.3) !important;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .action-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .action-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .action-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .action-button.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 0 20px rgba(245, 87, 108, 0.5);
        }

        .unit-selector {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .unit-selector.show {
            display: block;
        }

        .unit-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .unit-option {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .unit-option:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .unit-option.selected {
            background: rgba(255, 255, 255, 0.3);
            border-color: #ffd93d;
            box-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
        }

        .unit-icon {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .unit-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .unit-move {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .health-selector {
            margin-top: 15px;
            text-align: center;
        }

        .health-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 1.1em;
            width: 150px;
            text-align: center;
            margin: 0 10px;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .objective {
            background: rgba(255, 217, 61, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #ffd93d;
        }

        .current-action {
            background: rgba(100, 255, 100, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #64ff64;
        }

        .message {
            text-align: center;
            font-size: 1.2em;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .victory-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 0 50px rgba(255, 217, 61, 0.8);
        }

        .victory-message h1 {
            font-size: 3em;
            margin-bottom: 20px;
            color: #ffd93d;
        }

        .new-game-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 10px;
            font-size: 1.3em;
            cursor: pointer;
            margin-top: 20px;
        }

        .new-game-button:hover {
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .game-board {
                grid-template-columns: repeat(5, 60px);
                grid-template-rows: repeat(5, 60px);
            }
            
            .unit {
                font-size: 1.8em;
            }
            
            .game-title {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title">âš”ï¸ æ‹ ç‚¹åˆ¶åœ§ãƒãƒˆãƒ« âš”ï¸</h1>
        </div>

        <div class="game-status">
            <div class="player-info player1" id="player1-info">
                <h2><span class="player-indicator"></span>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ï¼ˆåŒ—è»ï¼‰</h2>
                <div class="resource-display">ğŸ’° è³‡æº: <span id="player1-resources">3</span></div>
                <div class="territory-count">ğŸ° é ˜åœ°: <span id="player1-territory">0</span>ãƒã‚¹</div>
            </div>
            <div class="player-info player2" id="player2-info">
                <h2><span class="player-indicator"></span>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ï¼ˆå—è»ï¼‰</h2>
                <div class="resource-display">ğŸ’° è³‡æº: <span id="player2-resources">5</span></div>
                <div class="territory-count">ğŸ° é ˜åœ°: <span id="player2-territory">0</span>ãƒã‚¹</div>
            </div>
        </div>

        <div class="game-board" id="gameBoard"></div>

        <div class="action-panel">
            <div class="action-buttons">
                <button class="action-button" onclick="selectAction('farm')">ğŸŒ¾ è¾²è€•ï¼ˆé ˜åœ°Ã—1è³‡æºç²å¾—ï¼‰</button>
                <button class="action-button" onclick="selectAction('recruit')">âš”ï¸ é€ å…µï¼ˆ1è³‡æº+è¿½åŠ =ä½“åŠ›ï¼‰</button>
                <button class="action-button" onclick="selectAction('move')">ğŸƒ ç§»å‹•/æ”»æ’ƒ</button>
            </div>

            <div class="unit-selector" id="unitSelector">
                <h3>ãƒ¦ãƒ‹ãƒƒãƒˆã‚’é¸æŠ:</h3>
                <div class="unit-options">
                    <div class="unit-option" onclick="selectUnit('king')">
                        <div class="unit-icon">â™”</div>
                        <div class="unit-name">ã‚­ãƒ³ã‚°</div>
                        <div class="unit-move">8æ–¹å‘1ãƒã‚¹</div>
                    </div>
                    <div class="unit-option" onclick="selectUnit('rook')">
                        <div class="unit-icon">â™œ</div>
                        <div class="unit-name">ãƒ«ãƒ¼ã‚¯</div>
                        <div class="unit-move">ç¸¦æ¨ª1-2ãƒã‚¹</div>
                    </div>
                    <div class="unit-option" onclick="selectUnit('bishop')">
                        <div class="unit-icon">â™—</div>
                        <div class="unit-name">ãƒ“ã‚·ãƒ§ãƒƒãƒ—</div>
                        <div class="unit-move">æ–œã‚1-2ãƒã‚¹</div>
                    </div>
                    <div class="unit-option" onclick="selectUnit('knight')">
                        <div class="unit-icon">â™</div>
                        <div class="unit-name">ãƒŠã‚¤ãƒˆ</div>
                        <div class="unit-move">Lå­—ç§»å‹•</div>
                    </div>
                </div>
                <div class="health-selector">
                    <label>ä½“åŠ›ï¼ˆè¿½åŠ è³‡æºï¼‰: 
                        <input type="number" id="healthInput" class="health-input" min="0" value="0">
                    </label>
                    <div style="margin-top: 10px; opacity: 0.8;">
                        åŸºæœ¬ã‚³ã‚¹ãƒˆ1 + è¿½åŠ è³‡æº = ä½“åŠ›
                    </div>
                </div>
            </div>
        </div>

        <div class="info-panel">
            <div class="objective">
                <h3>ğŸ¯ å‹åˆ©æ¡ä»¶</h3>
                <p>æ•µã®æ‹ ç‚¹ï¼ˆ<span style="color: #4ecdc4;">â– </span>å—è»ã¯A3 / <span style="color: #ff6b6b;">â– </span>åŒ—è»ã¯E3ï¼‰ã«è‡ªè»ãƒ¦ãƒ‹ãƒƒãƒˆã‚’é€²å…¥ã•ã›ã‚‹ï¼</p>
            </div>
            <div class="current-action" id="currentAction">
                <h3>ğŸ“ ç¾åœ¨ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
                <p id="actionDescription">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
            </div>
        </div>

        <div id="message" class="message"></div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = {
            currentPlayer: 1,
            board: Array(5).fill(null).map(() => Array(5).fill(null)),
            resources: { 1: 3, 2: 5 },
            territories: Array(5).fill(null).map(() => Array(5).fill(0)),
            selectedAction: null,
            selectedUnit: null,
            selectedUnitType: null,
            selectedCell: null,
            additionalHealth: 0,
            bases: { 1: {row: 0, col: 2}, 2: {row: 4, col: 2} }
        };

        // ãƒ¦ãƒ‹ãƒƒãƒˆã‚¢ã‚¤ã‚³ãƒ³
        const unitIcons = {
            king: 'â™”',
            rook: 'â™œ',
            bishop: 'â™—',
            knight: 'â™'
        };

        // åˆæœŸåŒ–
        function initGame() {
            // æ‹ ç‚¹ã‚’åˆæœŸé ˜åœ°ã¨ã—ã¦è¨­å®š
            gameState.territories[0][1] = 1; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®æ‹ ç‚¹ï¼ˆA3ï¼‰
            gameState.territories[0][2] = 1; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®æ‹ ç‚¹ï¼ˆA3ï¼‰
            gameState.territories[0][3] = 1; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®æ‹ ç‚¹ï¼ˆA3ï¼‰
            gameState.territories[1][2] = 1; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®æ‹ ç‚¹ï¼ˆA3ï¼‰
            gameState.territories[4][1] = 2; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®æ‹ ç‚¹ï¼ˆE3ï¼‰
            gameState.territories[4][2] = 2; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®æ‹ ç‚¹ï¼ˆE3ï¼‰
            gameState.territories[4][3] = 2; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®æ‹ ç‚¹ï¼ˆE3ï¼‰
            gameState.territories[3][2] = 2; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®æ‹ ç‚¹ï¼ˆE3ï¼‰
            
            createBoard();
            updateDisplay();
            showMessage("ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®ç•ªã§ã™ã€‚æ‹ ç‚¹ã«å…µã‚’é…ç½®ã§ãã¾ã™ï¼");
        }

        // ãƒœãƒ¼ãƒ‰ä½œæˆ
        function createBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // åº§æ¨™è¡¨ç¤º
                    const coords = document.createElement('div');
                    coords.className = 'cell-coords';
                    coords.textContent = `${String.fromCharCode(65 + row)}${col + 1}`;
                    cell.appendChild(coords);
                    
                    // æ‹ ç‚¹è¨­å®š
                    if (row === 0 && col === 2) {
                        cell.classList.add('base', 'base-1');
                    } else if (row === 4 && col === 2) {
                        cell.classList.add('base', 'base-2');
                    }
                    
                    cell.onclick = () => cellClick(row, col);
                    board.appendChild(cell);
                }
            }
        }

        // ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        function cellClick(row, col) {
            if (!gameState.selectedAction) {
                showMessage("ã¾ãšã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼");
                return;
            }

            if (gameState.selectedAction === 'recruit') {
                if (!gameState.selectedUnitType) {
                    showMessage("ãƒ¦ãƒ‹ãƒƒãƒˆã®ç¨®é¡ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼");
                    return;
                }
                placeUnit(row, col);
            } else if (gameState.selectedAction === 'move') {
                if (!gameState.selectedUnit) {
                    selectUnitForMove(row, col);
                } else {
                    moveOrAttack(row, col);
                }
            }
        }

        // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é¸æŠ
        function selectAction(action) {
            clearHighlights();
            gameState.selectedAction = action;
            gameState.selectedUnit = null;
            gameState.selectedUnitType = null;
            gameState.selectedCell = null;
            
            // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®æ›´æ–°
            document.querySelectorAll('.action-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ãƒ¦ãƒ‹ãƒƒãƒˆé¸æŠUI
            const unitSelector = document.getElementById('unitSelector');
            if (action === 'recruit') {
                unitSelector.classList.add('show');
                updateActionDescription("é…ç½®ã™ã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆã¨ä½“åŠ›ã‚’é¸æŠã—ã¦ãã ã•ã„");
                highlightPlaceableCells();
            } else {
                unitSelector.classList.remove('show');
                
                if (action === 'farm') {
                    executeFarm();
                } else if (action === 'move') {
                    updateActionDescription("ç§»å‹•ã™ã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„");
                }
            }
        }

        // ãƒ¦ãƒ‹ãƒƒãƒˆç¨®åˆ¥é¸æŠ
        function selectUnit(type) {
            gameState.selectedUnitType = type;
            
            // UIæ›´æ–°
            document.querySelectorAll('.unit-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.target.closest('.unit-option').classList.add('selected');
            
            updateActionDescription(`${type}ã‚’é…ç½®ã™ã‚‹ãƒã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆã‚³ã‚¹ãƒˆ: 1+${document.getElementById('healthInput').value}è³‡æºï¼‰`);
        }

        // è¾²è€•å®Ÿè¡Œ
        function executeFarm() {
            const territoryCount = countTerritory(gameState.currentPlayer);
            const gained = territoryCount;
            
            if (gained === 0) {
                showMessage("é ˜åœ°ãŒã‚ã‚Šã¾ã›ã‚“ï¼æ‹ ç‚¹ã‚‚é ˜åœ°ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã™ã€‚");
                return;
            }
            
            gameState.resources[gameState.currentPlayer] += gained;
            
            showMessage(`è¾²è€•å®Ÿè¡Œï¼${gained}è³‡æºã‚’ç²å¾—ã—ã¾ã—ãŸã€‚ï¼ˆé ˜åœ°${territoryCount}ãƒã‚¹ï¼‰`);
            updateActionDescription(`è¾²è€•å®Œäº†ï¼š${gained}è³‡æºã‚’ç²å¾—`);
            endTurn();
        }

        // ãƒ¦ãƒ‹ãƒƒãƒˆé…ç½®
        function placeUnit(row, col) {
            const player = gameState.currentPlayer;
            const additionalHealth = parseInt(document.getElementById('healthInput').value) || 0;
            const totalCost = 1 + additionalHealth;
            
            // è³‡æºãƒã‚§ãƒƒã‚¯
            if (gameState.resources[player] < totalCost) {
                showMessage("è³‡æºãŒä¸è¶³ã—ã¦ã„ã¾ã™ï¼");
                return;
            }
            
            // é…ç½®å¯èƒ½ãƒã‚§ãƒƒã‚¯
            if (gameState.board[row][col] !== null) {
                showMessage("ãã®ãƒã‚¹ã«ã¯é…ç½®ã§ãã¾ã›ã‚“ï¼");
                return;
            }
            
            if (gameState.territories[row][col] !== player) {
                showMessage("è‡ªé ˜åœ°ã«ã®ã¿é…ç½®å¯èƒ½ã§ã™ï¼åˆå›ã¯æ‹ ç‚¹ã«é…ç½®ã—ã¦ãã ã•ã„ã€‚");
                return;
            }
            
            // ãƒ¦ãƒ‹ãƒƒãƒˆé…ç½®
            gameState.board[row][col] = {
                player: player,
                type: gameState.selectedUnitType,
                health: totalCost
            };
            
            gameState.resources[player] -= totalCost;
            
            showMessage(`${gameState.selectedUnitType}ï¼ˆä½“åŠ›${totalCost}ï¼‰ã‚’é…ç½®ã—ã¾ã—ãŸï¼`);
            updateBoard();
            endTurn();
        }

        // ç§»å‹•ç”¨ãƒ¦ãƒ‹ãƒƒãƒˆé¸æŠ
        function selectUnitForMove(row, col) {
            const unit = gameState.board[row][col];
            if (!unit || unit.player !== gameState.currentPlayer) {
                showMessage("è‡ªè»ã®ãƒ¦ãƒ‹ãƒƒãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ï¼");
                return;
            }
            
            gameState.selectedUnit = {row, col};
            gameState.selectedCell = {row, col};
            clearHighlights();
            highlightPossibleMoves(row, col, unit.type);
            updateActionDescription(`${unit.type}ï¼ˆä½“åŠ›${unit.health}ï¼‰ã‚’é¸æŠä¸­ã€‚ç§»å‹•å…ˆã‚’é¸æŠã—ã¦ãã ã•ã„`);
        }

        // ç§»å‹•ãƒ»æ”»æ’ƒå®Ÿè¡Œ
        function moveOrAttack(targetRow, targetCol) {
            const {row: fromRow, col: fromCol} = gameState.selectedUnit;
            const unit = gameState.board[fromRow][fromCol];
            const targetUnit = gameState.board[targetRow][targetCol];
            
            // ç§»å‹•å¯èƒ½ãƒã‚§ãƒƒã‚¯
            if (!isValidMove(fromRow, fromCol, targetRow, targetCol, unit.type)) {
                showMessage("ãã“ã«ã¯ç§»å‹•ã§ãã¾ã›ã‚“ï¼");
                return;
            }
            
            if (!targetUnit) {
                // é€šå¸¸ç§»å‹•
                gameState.board[targetRow][targetCol] = unit;
                gameState.board[fromRow][fromCol] = null;
                gameState.territories[targetRow][targetCol] = gameState.currentPlayer;
                
                // å‹åˆ©åˆ¤å®š
                const enemyBase = gameState.bases[3 - gameState.currentPlayer];
                if (targetRow === enemyBase.row && targetCol === enemyBase.col) {
                    showVictory(gameState.currentPlayer);
                    return;
                }
                
                showMessage("ç§»å‹•å®Œäº†ï¼");
                updateBoard();
                endTurn();
            } else if (targetUnit.player !== unit.player) {
                // æ•µãƒ¦ãƒ‹ãƒƒãƒˆã¸ã®å‡¦ç†
                if (unit.health > targetUnit.health) {
                    // æ’ƒç ´ã—ã¦ç§»å‹•
                    gameState.board[targetRow][targetCol] = unit;
                    gameState.board[fromRow][fromCol] = null;
                    gameState.territories[targetRow][targetCol] = gameState.currentPlayer;
                    
                    // å‹åˆ©åˆ¤å®š
                    const enemyBase = gameState.bases[3 - gameState.currentPlayer];
                    if (targetRow === enemyBase.row && targetCol === enemyBase.col) {
                        showVictory(gameState.currentPlayer);
                        return;
                    }
                    
                    showMessage(`æ•µãƒ¦ãƒ‹ãƒƒãƒˆã‚’æ’ƒç ´ã—ã¾ã—ãŸï¼`);
                } else {
                    // æ”»æ’ƒã®ã¿
                    targetUnit.health -= unit.health;
                    if (targetUnit.health <= 0) {
                        gameState.board[targetRow][targetCol] = null;
                        showMessage(`æ•µãƒ¦ãƒ‹ãƒƒãƒˆã‚’ç ´å£Šã—ã¾ã—ãŸï¼`);
                    } else {
                        showMessage(`æ•µãƒ¦ãƒ‹ãƒƒãƒˆã«${unit.health}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ï¼ˆæ®‹ã‚Šä½“åŠ›: ${targetUnit.health}ï¼‰`);
                    }
                }
                updateBoard();
                endTurn();
            }
        }

        // ç§»å‹•å¯èƒ½åˆ¤å®š
        function isValidMove(fromRow, fromCol, toRow, toCol, unitType) {
            const dr = toRow - fromRow;
            const dc = toCol - fromCol;
            
            if (fromRow === toRow && fromCol === toCol) return false;
            
            switch (unitType) {
                case 'king':
                    return Math.abs(dr) <= 1 && Math.abs(dc) <= 1;
                    
                case 'rook':
                    if (dr === 0) {
                        return Math.abs(dc) <= 2 && !hasObstacle(fromRow, fromCol, toRow, toCol);
                    } else if (dc === 0) {
                        return Math.abs(dr) <= 2 && !hasObstacle(fromRow, fromCol, toRow, toCol);
                    }
                    return false;
                    
                case 'bishop':
                    if (Math.abs(dr) === Math.abs(dc) && Math.abs(dr) <= 2) {
                        return !hasObstacle(fromRow, fromCol, toRow, toCol);
                    }
                    return false;
                    
                case 'knight':
                    return (Math.abs(dr) === 2 && Math.abs(dc) === 1) || 
                           (Math.abs(dr) === 1 && Math.abs(dc) === 2);
                           
                default:
                    return false;
            }
        }

        // éšœå®³ç‰©ãƒã‚§ãƒƒã‚¯
        function hasObstacle(fromRow, fromCol, toRow, toCol) {
            const dr = Math.sign(toRow - fromRow);
            const dc = Math.sign(toCol - fromCol);
            let r = fromRow + dr;
            let c = fromCol + dc;
            
            while (r !== toRow || c !== toCol) {
                if (gameState.board[r][c] !== null) return true;
                r += dr;
                c += dc;
            }
            return false;
        }

        // å¯èƒ½ãªç§»å‹•å…ˆã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        function highlightPossibleMoves(row, col, unitType) {
            const moves = getPossibleMoves(row, col, unitType);
            const unit = gameState.board[row][col];
            
            moves.forEach(({r, c}) => {
                const cell = document.querySelector(`[data-row="${r}"][data-col="${c}"]`);
                const targetUnit = gameState.board[r][c];
                
                if (!targetUnit) {
                    cell.classList.add('highlight-move');
                } else if (targetUnit.player !== unit.player && unit.health > targetUnit.health) {
                    cell.classList.add('highlight-move');
                } else if (targetUnit.player !== unit.player) {
                    cell.classList.add('highlight-attack');
                }
            });
        }

        // å¯èƒ½ãªç§»å‹•å…ˆã‚’å–å¾—
        function getPossibleMoves(row, col, unitType) {
            const moves = [];
            
            switch (unitType) {
                case 'king':
                    for (let dr = -1; dr <= 1; dr++) {
                        for (let dc = -1; dc <= 1; dc++) {
                            if (dr === 0 && dc === 0) continue;
                            const r = row + dr;
                            const c = col + dc;
                            if (r >= 0 && r < 5 && c >= 0 && c < 5) {
                                moves.push({r, c});
                            }
                        }
                    }
                    break;
                    
                case 'rook':
                    for (let d = 1; d <= 2; d++) {
                        [{r: row+d, c: col}, {r: row-d, c: col}, 
                         {r: row, c: col+d}, {r: row, c: col-d}].forEach(({r, c}) => {
                            if (r >= 0 && r < 5 && c >= 0 && c < 5 && 
                                isValidMove(row, col, r, c, unitType)) {
                                moves.push({r, c});
                            }
                        });
                    }
                    break;
                    
                case 'bishop':
                    for (let d = 1; d <= 2; d++) {
                        [{r: row+d, c: col+d}, {r: row+d, c: col-d}, 
                         {r: row-d, c: col+d}, {r: row-d, c: col-d}].forEach(({r, c}) => {
                            if (r >= 0 && r < 5 && c >= 0 && c < 5 && 
                                isValidMove(row, col, r, c, unitType)) {
                                moves.push({r, c});
                            }
                        });
                    }
                    break;
                    
                case 'knight':
                    const knightMoves = [
                        {r: row+2, c: col+1}, {r: row+2, c: col-1},
                        {r: row-2, c: col+1}, {r: row-2, c: col-1},
                        {r: row+1, c: col+2}, {r: row+1, c: col-2},
                        {r: row-1, c: col+2}, {r: row-1, c: col-2}
                    ];
                    knightMoves.forEach(({r, c}) => {
                        if (r >= 0 && r < 5 && c >= 0 && c < 5) {
                            moves.push({r, c});
                        }
                    });
                    break;
            }
            
            return moves;
        }

        // é…ç½®å¯èƒ½ãƒã‚¹ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        function highlightPlaceableCells() {
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    if (gameState.board[row][col] === null && 
                        gameState.territories[row][col] === gameState.currentPlayer) {
                        const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                        cell.classList.add('highlight-place');
                    }
                }
            }
        }

        // ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚¯ãƒªã‚¢
        function clearHighlights() {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.classList.remove('highlight-move', 'highlight-attack', 'highlight-place');
            });
        }

        // é ˜åœ°ã‚«ã‚¦ãƒ³ãƒˆ
        function countTerritory(player) {
            let count = 0;
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    if (gameState.territories[row][col] === player) count++;
                }
            }
            return count;
        }

        // ã‚¿ãƒ¼ãƒ³çµ‚äº†
        function endTurn() {
            gameState.currentPlayer = 3 - gameState.currentPlayer;
            gameState.selectedAction = null;
            gameState.selectedUnit = null;
            gameState.selectedUnitType = null;
            clearHighlights();
            
            document.querySelectorAll('.action-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('unitSelector').classList.remove('show');
            
            updateDisplay();
            updateActionDescription("ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„");
            showMessage(`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${gameState.currentPlayer}ã®ç•ªã§ã™ã€‚`);
        }

        // è¡¨ç¤ºæ›´æ–°
        function updateDisplay() {
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±æ›´æ–°
            document.getElementById('player1-resources').textContent = gameState.resources[1];
            document.getElementById('player2-resources').textContent = gameState.resources[2];
            document.getElementById('player1-territory').textContent = countTerritory(1);
            document.getElementById('player2-territory').textContent = countTerritory(2);
            
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¡¨ç¤º
            document.getElementById('player1-info').classList.toggle('active', gameState.currentPlayer === 1);
            document.getElementById('player2-info').classList.toggle('active', gameState.currentPlayer === 2);
            
            updateBoard();
        }

        // ãƒœãƒ¼ãƒ‰è¡¨ç¤ºæ›´æ–°
        function updateBoard() {
            document.querySelectorAll('.cell').forEach(cell => {
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                const unit = gameState.board[row][col];
                
                // é ˜åœ°è¡¨ç¤º
                cell.classList.remove('territory-1', 'territory-2');
                if (gameState.territories[row][col] > 0) {
                    cell.classList.add(`territory-${gameState.territories[row][col]}`);
                }
                
                // æ‹ ç‚¹ã®é ˜åœ°è¡¨ç¤ºã‚’ç¢ºå®Ÿã«
                if ((row === 0 && col === 2) || (row === 4 && col === 2)) {
                    const player = row === 0 ? 1 : 2;
                    if (gameState.territories[row][col] === player) {
                        cell.classList.add(`territory-${player}`);
                    }
                }
                
                // ãƒ¦ãƒ‹ãƒƒãƒˆè¡¨ç¤º
                const existingUnit = cell.querySelector('.unit');
                if (existingUnit) existingUnit.remove();
                
                if (unit) {
                    const unitDiv = document.createElement('div');
                    unitDiv.className = 'unit';
                    unitDiv.innerHTML = `
                        ${unitIcons[unit.type]}
                        <div class="unit-health">${unit.health}</div>
                    `;
                    unitDiv.style.color = unit.player === 1 ? '#ff6b6b' : '#4ecdc4';
                    cell.appendChild(unitDiv);
                }
            });
        }

        // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³èª¬æ˜æ›´æ–°
        function updateActionDescription(text) {
            document.getElementById('actionDescription').textContent = text;
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showMessage(text) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.style.display = 'block';
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 3000);
        }

        // å‹åˆ©è¡¨ç¤º
        function showVictory(player) {
            const victory = document.createElement('div');
            victory.className = 'victory-message';
            victory.innerHTML = `
                <h1>ğŸ‰ å‹åˆ©ï¼ ğŸ‰</h1>
                <p>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${player}ãŒå‹åˆ©ã—ã¾ã—ãŸï¼</p>
                <button class="new-game-button" onclick="location.reload()">æ–°ã—ã„ã‚²ãƒ¼ãƒ </button>
            `;
            document.body.appendChild(victory);
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        initGame();
    </script>
</body>
</html>